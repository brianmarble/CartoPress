<!doctype html>
<title>CartoPress Test</title>
<script src="http://openlayers.org/api/OpenLayers.js"></script>
<style>
	#map {
		width: 800px;
		height: 500px;
		border: solid black 1px;
		margin: auto;
	}
	#options {
		float: right;
	}
</style>
<script src="../CartoPress.js"></script>
<div id="options">
	<div>Choose Page Layout: <select id="layouts"></select></div>
	<div><input id="printButton" type="button" value="print"/></div>
</div>
<div id="map"></div>
<script>
	
	
	function BaseLayer(){
		return new OpenLayers.Layer.WMS(
			"BaseLayer",
			"http://mt.10000maps.com/dev/ms", 
			{
				map: 'landmaps/Base_Layers.map', 
				layers: 'BaseLayers_SimpleBase2'
			}
		);
	}
	
	function ForestLayer(){
		return new OpenLayers.Layer.WMS(
			"Layer2",
			"http://mt.10000maps.com/dev/ms",
			{
				map: 'landmaps/Worldwide_Land.map',
				layers: 'World_Forestland',
				transparent: 'true'
			}
		);
	}
	
	function Map(mapDivId){
		var lat = 4099508.5373339, lon = -10429774.028535;
		var baseLayer = new BaseLayer();
		var forestLayer = new ForestLayer();
		var map = new OpenLayers.Map(
			mapDivId,
			{
				projection: "EPSG:900913"
			}
		);
		map.addLayers([baseLayer, forestLayer]);
		map.setBaseLayer(baseLayer);
		map.setCenter(new OpenLayers.LonLat(lon,lat), 4);
		
		return map;
	}

	var map = new Map('map');
	
	var cp = new CartoPress(map);
	
	cp.getPageLayouts(function(formats){
		var selectLayoutDiv = document.getElementById('layouts'),
			optionEl;
		for(var i = 0; i < formats.length; i++){
			optionEl = document.createElement('option');
			optionEl.textContent = formats[i];
			optionEl.value = formats[i];
			selectLayoutDiv.appendChild(optionEl);
		}
		cp.setPageLayout(formats[0]);
		cp.activate();
	})
	
	document.getElementById('layouts').addEventListener('change',function(){
		var val = document.getElementById('layouts').value;
		cp.setPageLayout(val);
	});
	document.getElementById('printButton').addEventListener('click',print);
	
	function print(){
		cp.print(function(url){
			location.assign(url);
		});
		var button = document.getElementById('printButton');
		var p = button.parentElement;
		p.removeChild(button);
		p.appendChild(document.createTextNode('Working . . .'));
		
	}

</script>
